<!DOCTYPE html> <html itemscope itemtype="http://schema.org/Person" lang="it"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1 maximum-scale=1; minimum-scale=1; user-scalable=no;"> <meta name="keywords" content="kace,k1000,script,vbs,visualbasic,smartcard,security,encryption"> <meta name="baseurl" content=""> <meta name="robots" content="index,follow" /> <meta name="rating" content="general"> <!-- favicon --> <link rel="shortcut icon" href=" /static/assets/img/favicon.jpg "> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>[K1000 Scripting] Find and report all PCs with a smartcard reader installed | Home</title> <meta name="generator" content="Jekyll v4.2.2" /> <meta property="og:title" content="[K1000 Scripting] Find and report all PCs with a smartcard reader installed" /> <meta name="author" content="Saurabh" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Find and report all managed Windows PCs in K1000 Inventory with a smartcard reader installed." /> <meta property="og:description" content="Find and report all managed Windows PCs in K1000 Inventory with a smartcard reader installed." /> <link rel="canonical" href="http://localhost:4000/blog/kace/k1000-report-pc-with-smartcard-reader/" /> <meta property="og:url" content="http://localhost:4000/blog/kace/k1000-report-pc-with-smartcard-reader/" /> <meta property="og:site_name" content="Home" /> <meta property="og:image" content="http://localhost:4000/static/assets/img/blog/kace/smartcard/kace.jpg" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2018-02-14T00:00:00+05:30" /> <meta name="twitter:card" content="summary_large_image" /> <meta property="twitter:image" content="http://localhost:4000/static/assets/img/blog/kace/smartcard/kace.jpg" /> <meta property="twitter:title" content="[K1000 Scripting] Find and report all PCs with a smartcard reader installed" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Saurabh"},"dateModified":"2018-02-14T00:00:00+05:30","datePublished":"2018-02-14T00:00:00+05:30","description":"Find and report all managed Windows PCs in K1000 Inventory with a smartcard reader installed.","headline":"[K1000 Scripting] Find and report all PCs with a smartcard reader installed","image":"http://localhost:4000/static/assets/img/blog/kace/smartcard/kace.jpg","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/blog/kace/k1000-report-pc-with-smartcard-reader/"},"url":"http://localhost:4000/blog/kace/k1000-report-pc-with-smartcard-reader/"}</script> <!-- End Jekyll SEO tag --> <!-- Blog --> <!-- Main CSS --> <link href="/static/assets/app-20190620.min.css" rel="stylesheet"> <link href="/static/css/custom.css" rel="stylesheet"> <!-- Layout Specific CSS --> <link href="/static/css/blogpadding.css" rel="stylesheet" media="screen"> <link href="/static/css/blogmenu.css" rel="stylesheet" media="screen"> <!-- Post/Page Specific CSS --> <!-- Main Scripts --> <script src="/static/assets/app-20190620.min.js"></script> <script src="/static/assets/blog-20190620.min.js"></script> <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/cookie-bar/cookiebar-latest.min.js?theme=momh&customize=1&always=1&showNoConsent=1&showPolicyLink=1&privacyPage=https%3A%2F%2Fcristiancastellari.it%2Fabout%2Fprivacy%2F"></script> </head> <body id="page-top" class="landing-page"> <div class="search-tool" style="position: fixed; top: 0px ; bottom: 0px; left: 0px; right: 0px; opacity: 0.95; background-color: #111111; z-index: 9999; display: none;"> <input type="text" class="form-control search-content" id="search-content" style="position: fixed; top: 60px" placeholder="Search Blog"> <div style="position: fixed; top: 16px; right: 16px; z-index: 9999;"> <img src="/static/assets/img/search/cb-close.png" id="close-btn"/> </div> </div> <div style="position: fixed; right: 16px; bottom: 20px; z-index: 9999;"> <img src="/static/assets/img/search/cb-search.png" id="search-btn" title="Double click Ctrl"/> </div> <div class="navbar-wrapper"> <nav class="navbar navbar-default navbar-fixed-top" role="navigation"> <div class="container"> <div class="navbar-header page-scroll"> <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a class="navbar-brand" href="/">Home</a> </div> <div id="navbar" class="navbar-collapse collapse"> <ul class="nav navbar-nav navbar-right"> <!-- <li><a class="page-scroll" href="/#"></a></li> --> <li> <a class="page-scroll" href="/blog/">Blog</a></li> </ul> </div> </div> </nav> </div> <div id="post"> <div class="wrapper wrapper-content animated fadeInRight article"> <div class="row"> <div class="col-lg-10 col-lg-offset-1"> <div class="ibox"> <div class="ibox-content"> <div class="pull-right"> <a class="btn btn-white btn-xs" href="/kace">Kace</a> </div> <div class="text-center article-title"> <span class="text-muted"><i class="fa fa-clock-o"></i> 14 Feb 2018</span> <h1> [K1000 Scripting] Find and report all PCs with a smartcard reader installed </h1> <div class="vote-info"> <i class="fa fa-book"></i> <a>784 Parole</a> <i class="fa fa-clock-o"></i> <a>Tempo di lettura: 4 minuti</a> </div> </div> <div class="desc"> <img itemprop="image" class="post-image" src="/static/assets/img/blog/kace/smartcard/kace.jpg" alt="[K1000 Scripting] Find and report all PCs with a smartcard reader installed"> <p itemprop="description" class="intro">The Custom Inventory Rule creates a new entry in every managed device. If a smart card reader has been discovered we’ll have at least one “DeviceClass: SMARTCARDREADER” text iside the Custom Inventory Fields section into every device record in Inventory / Devices</p> </div> <article> <h1 id="target">Target</h1> <p>Find and report all managed Windows PCs in K1000 Inventory with a smartcard reader installed.</p> <h2 id="overview">Overview</h2> <p>The script does not depend on K1000, so if you don’t have KACE SMA in your environment don’t worry: the script is still useful!</p> <h2 id="components">Components</h2> <ul> <li>[The Query] This script</li> <li>[The Automation] Kace Systems Management Appliance (AKA ‘K1000’)</li> </ul> <h2 id="how-it-works">How it works</h2> <ol> <li>The vbs script executes a WMI query over the target device(s) and saves an output file named <em>smartcard.txt</em> (see below in the <a href="#setup">Setup section</a>)</li> <li>The vbs script is scheduled and deployed to the target device(s) via K1000 <a href="#the-kscript"><em>Online KScript</em></a></li> <li>A K1000 <a href="#the-custom-inventory-rule"><em>Custom Inventory Rule</em></a> reads the output file for every inventoried device and stores the information in the database</li> <li>A scheduled <a href="#the-report">Report</a> (choose your favorite format between HTML, CSV, PDF or Excel) returns only PCs with a smart card reader installed</li> <li>Done!</li> </ol> <h2 id="setup">Setup</h2> <h3 id="the-kscript-smarcardvbs">The KScript (smarcard.vbs)</h3> <ul> <li>Download <a href="/static/assets/files/blog/kace-smartcard/smartcard.vbs">the script</a> or copy &amp; paste the following code:</li> </ul> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>strComputer <span class="o">=</span> <span class="s2">"."</span>
Dim log
Set log <span class="o">=</span> Wscript.CreateObject<span class="o">(</span><span class="s2">"Scripting.Filesystemobject"</span><span class="o">)</span>
Set f <span class="o">=</span> log.CreateTextFile<span class="o">(</span><span class="s2">"C:</span><span class="se">\T</span><span class="s2">ools</span><span class="se">\s</span><span class="s2">martcard.txt"</span>, 2<span class="o">)</span>
Set objWMIService <span class="o">=</span> GetObject<span class="o">(</span><span class="s2">"winmgmts:</span><span class="se">\\</span><span class="s2">"</span> &amp; strComputer &amp; <span class="s2">"</span><span class="se">\r</span><span class="s2">oot</span><span class="se">\C</span><span class="s2">IMV2"</span><span class="o">)</span> 
Set colItems <span class="o">=</span> objWMIService.ExecQuery<span class="o">(</span> _
    <span class="s2">"SELECT * FROM Win32_PnPSignedDriver Where DeviceClass = 'SMARTCARDREADER'"</span>,,48<span class="o">)</span> 
For Each objItem <span class="k">in </span>colItems 
    f.WriteLine <span class="s2">"DeviceClass: "</span> &amp; objItem.DeviceClass
Next
f.Close
</code></pre></div></div> <ul> <li>Edit <strong>line 4</strong> with the path where you want to save the output file. In our environment every PC has a <em>“C:\Tools”</em> directory for service purpose, so I decided to save the output there.</li> </ul> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Set f = log.CreateTextFile("C:\Tools\smartcard.txt", 2)
</code></pre></div></div> <ul> <li> <p>Go to your <em>K1000 Dashboard</em>, then go to <em>Scripting</em> and create a <strong>New Script</strong> (<em>Choose Action / New</em>)</p> </li> <li> <p>Name the script as your wish (for example: Check Smart Card Reader) and follow these steps:</p> </li> </ul> <h4 id="script-basic-settings">Script Basic Settings</h4> <ul> <li>Type: <strong>Online KScript</strong></li> <li>Enabled: <strong>Yes</strong></li> <li>Deploy: one or some devices, all devices or to a Device Label, according to your needs in your environment</li> <li>Windows Run As: <strong>Local System</strong></li> <li>Upload the smartcard.vbs as <strong>New Dependecy</strong></li> </ul> <h4 id="tasks">Tasks</h4> <p>We want the script to run once in every PC, so we’ll use a “checkmark” (the smartcard.txt) to verify that…</p> <ul> <li>Verify: <strong>Verify a file exists…</strong> <ul> <li>C:\Tools\smartcard.txt</li> </ul> </li> <li>Remediation: <strong>Launch a program…</strong> <ul> <li>Directory: <strong>$(KACE_SYS_DIR)</strong></li> <li>File: <strong>cscript.exe $(KACE_DEPENDENCY_DIR)\smartcard.vbs</strong></li> <li>Wait for completion: <strong>Yes</strong></li> </ul> </li> <li>On Remediation Success: <strong>Upload a file…</strong> (note: this step is not necessary and only for archiving purpose) <ul> <li>Directory: <strong>C:\Tools</strong></li> <li>File: <strong>smartcard.txt</strong></li> </ul> </li> </ul> <p>…and <strong>Save</strong> your brand new script.</p> <p>The Task and its steps are summarized in the following image. When you’re ready, let’s jump to the <a href="#the-custom-inventory-rule">Step 4!</a></p> <p><img src="/static/assets/img/blog/kace/smartcard/screenshot1.png" alt="Screenshot 1" /></p> <h3 id="the-custom-inventory-rule">The Custom Inventory Rule</h3> <ol> <li> <p>In the K100 Dashboard, now go to <em>Inventory</em> section, then go to <em>Software</em> and create a <strong>new Software entry</strong> (<em>Choose Action / New</em>)</p> </li> <li> <p>Name the rule as your wish (for example: IT Dep — Check Smart Card Reader) and follow these steps:</p> </li> </ol> <ul> <li>Publisher: <strong>IT Department</strong> (it’s useful for further searches into the <em>Software Inventory</em>)</li> <li>Supported Operating Systems: <strong>All the Windows OSs in your Inventory</strong></li> <li>Custom Inventory Rule: <code class="language-plaintext highlighter-rouge">ShellCommandTextReturn(cmd /c type C:\Tools\smartcard.txt)</code></li> </ul> <p>…and <strong>Save</strong> your new Custom Inventory Rule.</p> <p>Here’s the summary image</p> <p><img src="/static/assets/img/blog/kace/smartcard/screenshot2.png" alt="Screenshot 1" /></p> <p>Now we need all our devices complete their inventory. The new Custom Inventory Rule creates a new entry in every device record managed by the K1000.</p> <p>If a smart card reader has been discovered we’ll have at least one “DeviceClass: SMARTCARDREADER” text iside the <strong>Custom Inventory Fields</strong> section into every device record in <em>Inventory / Devices</em></p> <p><img src="/static/assets/img/blog/kace/smartcard/screenshot3.png" alt="Screenhot 3" /></p> <p>Otherwise, if a smart card reader has not been discovered, we’ll have no text</p> <p>When all your devices has been inventoried and you’re ready, jump to the <a href="#the-report">next section</a></p> <h3 id="the-report">The Report</h3> <p>In the K100 Dashboard, now go to <em>Reporting</em> section, then in <em>Reports</em> and create a new Report (<em>Choose Action / New</em>)</p> <p>Name the Report as your wish (for example: PCs with Smart Card Reader) and follow these steps:</p> <h4 id="title-and-topic">Title and Topic</h4> <ul> <li>Category: <strong>Inventory</strong></li> <li>Topic: <strong>Device</strong></li> </ul> <h4 id="fields-to-display">Fields to Display</h4> <ul> <li>Device: <strong>System Name</strong></li> <li>Operating System Info: <strong>Name</strong></li> <li>User Information: <strong>User Name</strong></li> <li>Manufacturer and BIOS: <strong>System Model</strong></li> </ul> <p>Feel free to add and modify any other field, according to your needings.</p> <h4 id="filters">Filters</h4> <p>Delete the default filter and create this:</p> <p><img src="/static/assets/img/blog/kace/smartcard/report1.png" alt="Filter" /></p> <p><strong>Save</strong> your new report and try it.</p> </article> <hr> <div class="row"> <div class="row"> <div class="col-md-6"> <h5 style="display: inline;">Tags:</h5> <button class="btn btn-white btn-xs" type="button">kace</button> <button class="btn btn-white btn-xs" type="button">script</button> <button class="btn btn-white btn-xs" type="button">vbs</button> <button class="btn btn-white btn-xs" type="button">smartcard</button> <button class="btn btn-white btn-xs" type="button">security</button> <button class="btn btn-white btn-xs" type="button">encryption</button> </div> <div class="col-md-6"> <div class="small text-right"> <div> </div> </div> </div> </div> <br> <div class="row"> <div class="col-lg-12"> <br> <!-- share --> <div class="share-box"> <h5>Condividi:</h5> <div class="share-buttons"> <a class="f" href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/blog/kace/k1000-report-pc-with-smartcard-reader/" onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook" > <i class="fa fa-facebook-official share-button"> facebook</i> </a> <a class="t" href="https://twitter.com/intent/tweet?text=[K1000 Scripting] Find and report all PCs with a smartcard reader installed&url=http://localhost:4000/blog/kace/k1000-report-pc-with-smartcard-reader/" onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter" > <i class="fa fa-twitter share-button"> twitter</i> </a> <a class="r" href="http://www.reddit.com/submit?url=http://localhost:4000/blog/kace/k1000-report-pc-with-smartcard-reader/" onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;" title="Share on Reddit" > <i class="fa fa-reddit-alien share-button"> reddit</i> </a> <a class="l" href="https://www.linkedin.com/shareArticle?mini=true&url=http://localhost:4000/blog/kace/k1000-report-pc-with-smartcard-reader/&title=[K1000 Scripting] Find and report all PCs with a smartcard reader installed&summary=Find and report all managed Windows PCs in K1000 Inventory with a smartcard reader installed.&source=Home" onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn" > <i class="fa fa-linkedin share-button"> linkedin</i> </a> <a class="e" href="mailto:?subject=[K1000 Scripting] Find and report all PCs with a smartcard reader installed&amp;body=Check out this site http://localhost:4000/blog/kace/k1000-report-pc-with-smartcard-reader/" title="Share via Email" > <i class="fa fa-envelope share-button"> email</i> </a> </div> </div> <br> <div class="related-container"> <h4 class="relh4">Potrebbe Interessarti Anche...</h4> <div class="rect"> <a href="/blog/kace/aggiornare-windows10-k1000/"> <div class="rel"> <img src="/static/assets/img/blog/kace/smartcard/kace.jpg" alt="Usiamo Kace per aggiornare un PC da Windows 7/8/10 all'ultima build di Windows 10"> <h5>Distribuire un aggiornamento di build di Windows 10 via Kace</h5> </div> </a> <a href="/blog/kace/distribuzione-certificati_ca-kace1000/"> <div class="rel"> <img src="/static/assets/img/blog/ssl.png" alt="Vediamo insieme come distribuire certificati Windows usando KACE 1000"> <h5>Come importare un certificato CA su PC Windows con Kace 1000</h5> </div> </a> <a href="/blog/kace/blocco-applicativo-k1000/"> <div class="rel"> <img src="/static/assets/img/blog/kace/smartcard/kace.jpg" alt="Come utilizzare KACE 1000 per il controllo ed il blocco dei software non autorizzati sui PC - Una breve guida."> <h5>Blocco delle applicazioni con K1000</h5> </div> </a> <a href="/blog/linux/idenficare-processi-zombie-linux/"> <div class="rel"> <img src="/static/assets/img/blog/zombiesign.jpg" alt="Vediamo come uccidere, con un semplice script, eventuali processi zombie rimasti attivi sul nostro server Linux"> <h5>Identificare e terminare processi zombie su Linux</h5> </div> </a> </div> <!-- comment --> </div> </div> <br> </div> <!-- </div> --> </div> </div> </div> </div> </div> </div> <div class="row" style="background: #1c1e1e"> <div class="col-lg-8 col-lg-offset-2 text-center m-t-lg m-b-lg"> <p id="jalpc_site_pv" style="color: #FFFFFF"> <strong>&copy; 2019 - 2022 Home</strong><br /> <a href="/about/disclaimer/"> Disclaimer </a> | <a href="/about/privacy/"> Informativa Privacy</a> <a rel="me" style="display:none;" href="https://mastodon.uno/@cristiancastellari">Mastodon - @cristiancastellari@mastodon.uno</a> <a rel="me" style="display:none;" href="https://livellosegreto.it/@cristian">@cristian@livellosegreto.it</a> <a rel="me" style="display:none;" href="https://sociale.network/@cristian"></a> </p> </div> </div> </body> </html>
