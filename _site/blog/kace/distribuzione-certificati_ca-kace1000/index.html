<!DOCTYPE html> <html itemscope itemtype="http://schema.org/Person" lang="it"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1 maximum-scale=1; minimum-scale=1; user-scalable=no;"> <meta name="keywords" content="kace,k1000,script,batch,ssl,certificate,certutil,kscript"> <meta name="baseurl" content=""> <meta name="robots" content="index,follow" /> <meta name="rating" content="general"> <!-- favicon --> <link rel="shortcut icon" href=" /static/assets/img/favicon.jpg "> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Come importare un certificato CA su PC Windows con Kace 1000 | Home</title> <meta name="generator" content="Jekyll v4.2.2" /> <meta property="og:title" content="Come importare un certificato CA su PC Windows con Kace 1000" /> <meta name="author" content="Saurabh" /> <meta property="og:locale" content="it_IT" /> <meta name="description" content="Vediamo insieme come distribuire certificati Windows usando KACE 1000" /> <meta property="og:description" content="Vediamo insieme come distribuire certificati Windows usando KACE 1000" /> <link rel="canonical" href="https://relativist1.github.io/blog/kace/distribuzione-certificati_ca-kace1000/" /> <meta property="og:url" content="https://relativist1.github.io/blog/kace/distribuzione-certificati_ca-kace1000/" /> <meta property="og:site_name" content="Home" /> <meta property="og:image" content="https://relativist1.github.io/static/assets/img/blog/ssl.png" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2018-09-17T11:30:00+05:30" /> <meta name="twitter:card" content="summary_large_image" /> <meta property="twitter:image" content="https://relativist1.github.io/static/assets/img/blog/ssl.png" /> <meta property="twitter:title" content="Come importare un certificato CA su PC Windows con Kace 1000" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Saurabh"},"dateModified":"2018-09-17T11:30:00+05:30","datePublished":"2018-09-17T11:30:00+05:30","description":"Vediamo insieme come distribuire certificati Windows usando KACE 1000","headline":"Come importare un certificato CA su PC Windows con Kace 1000","image":"https://relativist1.github.io/static/assets/img/blog/ssl.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://relativist1.github.io/blog/kace/distribuzione-certificati_ca-kace1000/"},"url":"https://relativist1.github.io/blog/kace/distribuzione-certificati_ca-kace1000/"}</script> <!-- End Jekyll SEO tag --> <!-- Blog --> <!-- Main CSS --> <link href="/static/assets/app-20190620.min.css" rel="stylesheet"> <link href="/static/css/custom.css" rel="stylesheet"> <!-- Layout Specific CSS --> <link href="/static/css/blogpadding.css" rel="stylesheet" media="screen"> <link href="/static/css/blogmenu.css" rel="stylesheet" media="screen"> <!-- Post/Page Specific CSS --> <!-- Main Scripts --> <script src="/static/assets/app-20190620.min.js"></script> <script src="/static/assets/blog-20190620.min.js"></script> <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/cookie-bar/cookiebar-latest.min.js?theme=momh&customize=1&always=1&showNoConsent=1&showPolicyLink=1&privacyPage=https%3A%2F%2Fcristiancastellari.it%2Fabout%2Fprivacy%2F"></script> </head> <body id="page-top" class="landing-page"> <div class="search-tool" style="position: fixed; top: 0px ; bottom: 0px; left: 0px; right: 0px; opacity: 0.95; background-color: #111111; z-index: 9999; display: none;"> <input type="text" class="form-control search-content" id="search-content" style="position: fixed; top: 60px" placeholder="Search Blog"> <div style="position: fixed; top: 16px; right: 16px; z-index: 9999;"> <img src="/static/assets/img/search/cb-close.png" id="close-btn"/> </div> </div> <div style="position: fixed; right: 16px; bottom: 20px; z-index: 9999;"> <img src="/static/assets/img/search/cb-search.png" id="search-btn" title="Double click Ctrl"/> </div> <div class="navbar-wrapper"> <nav class="navbar navbar-default navbar-fixed-top" role="navigation"> <div class="container"> <div class="navbar-header page-scroll"> <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a class="navbar-brand" href="/">Home</a> </div> <div id="navbar" class="navbar-collapse collapse"> <ul class="nav navbar-nav navbar-right"> <!-- <li><a class="page-scroll" href="/#"></a></li> --> <li> <a class="page-scroll" href="/blog/">Blog</a></li> <li> <a class="page-scroll" href="/kace/">Kace</a></li> <li> <a class="page-scroll" href="/html/">HTML</a></li> <li> <a class="page-scroll" href="/itil/">ITIL</a></li> <li> <a class="page-scroll" href="/linux/">Linux</a></li> <li> <a class="page-scroll" href="/wordpress/">Wordpress</a></li> <li> <a class="page-scroll" href="/games/">Games</a></li> <li> <a class="page-scroll" href="/tools/">Tools</a></li> <li> <a class="page-scroll" href="/life/">Life</a></li> </ul> </div> </div> </nav> </div> <div id="post"> <div class="wrapper wrapper-content animated fadeInRight article"> <div class="row"> <div class="col-lg-10 col-lg-offset-1"> <div class="ibox"> <div class="ibox-content"> <div class="pull-right"> <a class="btn btn-white btn-xs" href="/kace">Kace</a> </div> <div class="text-center article-title"> <span class="text-muted"><i class="fa fa-clock-o"></i> 17 Sep 2018</span> <h1> Come importare un certificato CA su PC Windows con Kace 1000 </h1> <div class="vote-info"> <i class="fa fa-book"></i> <a>738 Parole</a> <i class="fa fa-clock-o"></i> <a>Tempo di lettura: 4 minuti</a> </div> </div> <div class="desc"> <img itemprop="image" class="post-image" src="/static/assets/img/blog/ssl.png" alt="Come importare un certificato CA su PC Windows con Kace 1000"> <p itemprop="description" class="intro">In un ambiente professionale, in cui è buona norma avere utenze Windows senza diritti di amministrazione del PC, anche l'installazione di una semplice CA può risultare difficoltosa in quanto è spesso richiesto l'intervento del reparto IT a cui è demandato il supporto utenti.</p> </div> <article> <p>Per installare certificati in maniera trasparente possiamo usare diversi metodi, il più ovvio e diffuso dei quali è senza dubbio una <em>GPO</em>. Ma non è sempre detto che la GPO sia la soluzione più veloce (ad esempio: chi deve eseguire il deploy dei certificati non ha i permessi per lavorare sulle GPO, o il certificato deve essere installato su un numero esiguo di PC per cui chi dovrebbe fare la GPO non considera questa un’attività primaria da svolgere ed i tempi rischiano di allungarsi)</p> <p>Andiamo quindi a vedere come <strong>distribuire un certificato CA self-signed tramite KACE 1000</strong>. In seguito andremo anche ad installare sui client, con la stessa procedura, un secondo certificato intermedio, validato a sua volta dalla CA.</p> <ul id="markdown-toc"> <li><a href="#lutility-certutilexe" id="markdown-toc-lutility-certutilexe">L’utility certutil.exe</a> <ul> <li><a href="#definizioni" id="markdown-toc-definizioni">Definizioni</a></li> <li><a href="#importazione-della-ca-tramite-certutilexe" id="markdown-toc-importazione-della-ca-tramite-certutilexe">Importazione della CA tramite certutil.exe</a></li> <li><a href="#importazione-del-certificato-intermedio" id="markdown-toc-importazione-del-certificato-intermedio">Importazione del certificato intermedio</a></li> </ul> </li> <li><a href="#lo-script-kscript-su-kace" id="markdown-toc-lo-script-kscript-su-kace">Lo script (kscript) su Kace</a> <ul> <li><a href="#riassunto-delle-attività" id="markdown-toc-riassunto-delle-attività">Riassunto delle Attività</a></li> <li><a href="#realizzazione" id="markdown-toc-realizzazione">Realizzazione</a></li> <li><a href="#schedulazione" id="markdown-toc-schedulazione">Schedulazione</a></li> </ul> </li> </ul> <h1 id="lutility-certutilexe">L’utility certutil.exe</h1> <p>certutil.exe è una utility, presente in tutti i sistemi Windows, che ci permette di fare tante cose con i certificati. Possiamo convertirli in caso il formato che abbiamo non sia quello che ci serve, possiamo importarli ed esportarli (sia in locale che su Active Directory), verificare la validità delle coppie di chiavi privata/pubblica eccetera.</p> <p>Si usa da riga di comando e per la sintassi completa vi rimando <a href="https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/certutil" target="_blank">all’apposita pagina</a> sulla Knowledge Base Micorosoft</p> <h2 id="definizioni">Definizioni</h2> <ul> <li>Entrambi i nostri certificati sono già in formato .cer</li> <li>Il certificato CA si chiama NGIRootCA01</li> <li>Il certificato intermedio si chiama NGISSLCA01.cer</li> </ul> <h2 id="importazione-della-ca-tramite-certutilexe">Importazione della CA tramite certutil.exe</h2> <p>Il comando di importazione, che possiamo eseguire da un qualsiasi prompt amministrativo, è il seguente</p> <div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">start</span> <span class="na">/wait </span><span class="nb">certutil</span> <span class="na">-addstore </span><span class="kd">Root</span> <span class="kd">NGIRootCA01</span>.cer
</code></pre></div></div> <p>Il parametro -addstore deifnisce il datastore in cui andremo ad installare il certificato. <em>Root</em> corrisponde a “<strong>Autorità di certificazione radice attendibili</strong>”</p> <h2 id="importazione-del-certificato-intermedio">Importazione del certificato intermedio</h2> <p>Il certificato intermedio (che chiameremo SSLCA01.cer) a cui si faceva riferimento poco fa si importerà nella stessa maniera, cambiando solamente il datastore di riferimento:</p><pre><code class="language-msdos">start /wait certutil -addstore CA NGISSLCA01.cer
</code></pre><h1 id="lo-script-kscript-su-kace">Lo script (kscript) su Kace</h1> <p>Andiamo ora a riportare tutto su Kace 1000, creando uno script apposito.</p> <h2 id="riassunto-delle-attività">Riassunto delle Attività</h2> <ul> <li>Impostazione dei parametri di base</li> <li>Importazione dei due certificati come dipendenze</li> <li>Creazione di un batch file</li> <li>Schedulazione</li> </ul> <h2 id="realizzazione">Realizzazione</h2> <ol> <li>Portiamoci in <em>Scripting / Scripts</em> e creiamo un novo kscript (“<em>New</em>”)</li> <li>Una volta definito un nome, portiamoci nella sezione <em>Operating Systems</em> e clicchiamo su <strong>Manage Operating Systems</strong>, andando a selezionare tutti i SO Windows (e, visto che andremo a creare un batch file, <strong>solo</strong> quelli Windows) di nostro interesse<br /> <img src="/static/assets/img/blog/kace/cassl/oss.png" alt="kscript Manage Operating Systems" /></li> <li>Verifichiamo che <em>Windows Run As</em> sia impostato a <strong>Local System</strong><br /> <img src="/static/assets/img/blog/kace/cassl/runas.png" alt="kscript Run As" /></li> <li> <p>Nella sezione <strong>Dependencies</strong> facciamo click su <strong>+New Dependency…</strong> e carichiamo:</p> <ol> <li>Il certificato Root</li> <li>Il certificato Intermedio<br /> <img src="/static/assets/img/blog/kace/cassl/certificati.png" alt="kscript Certificati" /></li> </ol> </li> <li> <p>Facciamo ora click su <strong>+Task…</strong> nella sezione sottostante ed impostiamo i seguenti passi:</p> <ol> <li><strong>Verify</strong> that the file “C:\Tools\certificato.ok” exists (questo ci servirà per fare un check sull’applicazione del certificato, che andremo a schedulare e qundi ad eseguire ad intervalli regolari; se il file <em>certificato.ok</em> esiste allora lo script si interrompe). Per riferimento sul percorso scelto, potete vedere <a href="/blog/kace/k1000-report-pc-with-smartcard-reader/" target="_blank">questo mio precedente articolo</a></li> <li><strong>On Success</strong>: nulla</li> <li><strong>Remediation</strong>: Run the batch file “<em>Install_CA_Root_Script</em>” with params “”<br /> <img src="/static/assets/img/blog/kace/cassl/script.png" alt="kscript Script" /><br /> Codice: <div class="language-dosbatch highlighter-rouge"><div class="highlight"><pre class="highlight"><code> @echo <span class="na">off</span>
 <span class="nb">start</span> <span class="na">/wait </span><span class="nb">certutil</span> <span class="na">-addstore </span><span class="kd">Root</span> <span class="kd">NGIRootCA01</span>.cer
 <span class="nb">start</span> <span class="na">/wait </span><span class="nb">certutil</span> <span class="na">-addstore </span><span class="kd">CA</span> <span class="kd">NGISSLCA01</span>.cer
 <span class="k">exit</span>
</code></pre></div> </div> </li> <li><strong>On Remediaton Success</strong> Launch a program…<br /> <img src="/static/assets/img/blog/kace/cassl/remediation.png" alt="kscript Remediation" /></li> </ol> </li> <li>Clicchiamo su <strong>Save</strong> per completare la creazione del kscript</li> </ol> <h2 id="schedulazione">Schedulazione</h2> <p>In caso volessimo schedulare lo script, sarà sufficiente, una volta tornati in editing, andare ad impostare la finestra desiderata. Ad esempio, nel nostro caso lo script verrà eseguito sui devices desiderati ogni tre ore secondo questa logica:</p> <ol> <li>Lo script viene eseguito la prima volta</li> <li>Al termine, lascia un file “<em>certificato.ok</em>”, di dimensione 0 bytes, in C:\Tools\</li> <li>Dalla volta seguente (ogni tre ore…) se trova il file “certificato.ok” allora si interrompe e non fa null’altro</li> </ol> <p><img src="/static/assets/img/blog/kace/cassl/schedule.png" alt="kscript Schedule" /></p> </article> <hr> <div class="row"> <div class="row"> <div class="col-md-6"> <h5 style="display: inline;">Tags:</h5> <button class="btn btn-white btn-xs" type="button">kace</button> <button class="btn btn-white btn-xs" type="button">k1000</button> <button class="btn btn-white btn-xs" type="button">script</button> <button class="btn btn-white btn-xs" type="button">batch</button> <button class="btn btn-white btn-xs" type="button">kscript</button> <button class="btn btn-white btn-xs" type="button">ssl</button> <button class="btn btn-white btn-xs" type="button">ca root</button> <button class="btn btn-white btn-xs" type="button">certificate</button> <button class="btn btn-white btn-xs" type="button">security</button> <button class="btn btn-white btn-xs" type="button">sicurezza</button> </div> <div class="col-md-6"> <div class="small text-right"> <div> </div> </div> </div> </div> <br> <div class="row"> <div class="col-lg-12"> <br> <!-- share --> <div class="share-box"> <h5>Condividi:</h5> <div class="share-buttons"> <a class="f" href="https://www.facebook.com/sharer/sharer.php?u=https://relativist1.github.io/blog/kace/distribuzione-certificati_ca-kace1000/" onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook" > <i class="fa fa-facebook-official share-button"> facebook</i> </a> <a class="t" href="https://twitter.com/intent/tweet?text=Come importare un certificato CA su PC Windows con Kace 1000&url=https://relativist1.github.io/blog/kace/distribuzione-certificati_ca-kace1000/" onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter" > <i class="fa fa-twitter share-button"> twitter</i> </a> <a class="r" href="http://www.reddit.com/submit?url=https://relativist1.github.io/blog/kace/distribuzione-certificati_ca-kace1000/" onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;" title="Share on Reddit" > <i class="fa fa-reddit-alien share-button"> reddit</i> </a> <a class="l" href="https://www.linkedin.com/shareArticle?mini=true&url=https://relativist1.github.io/blog/kace/distribuzione-certificati_ca-kace1000/&title=Come importare un certificato CA su PC Windows con Kace 1000&summary=Vediamo insieme come distribuire certificati Windows usando KACE 1000&source=Home" onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn" > <i class="fa fa-linkedin share-button"> linkedin</i> </a> <a class="e" href="mailto:?subject=Come importare un certificato CA su PC Windows con Kace 1000&amp;body=Check out this site https://relativist1.github.io/blog/kace/distribuzione-certificati_ca-kace1000/" title="Share via Email" > <i class="fa fa-envelope share-button"> email</i> </a> </div> </div> <br> <div class="related-container"> <h4 class="relh4">Potrebbe Interessarti Anche...</h4> <div class="rect"> <a href="/blog/kace/aggiornare-windows10-k1000/"> <div class="rel"> <img src="/static/assets/img/blog/kace/smartcard/kace.jpg" alt="Usiamo Kace per aggiornare un PC da Windows 7/8/10 all'ultima build di Windows 10"> <h5>Distribuire un aggiornamento di build di Windows 10 via Kace</h5> </div> </a> <a href="/blog/kace/blocco-applicativo-k1000/"> <div class="rel"> <img src="/static/assets/img/blog/kace/smartcard/kace.jpg" alt="Come utilizzare KACE 1000 per il controllo ed il blocco dei software non autorizzati sui PC - Una breve guida."> <h5>Blocco delle applicazioni con K1000</h5> </div> </a> <a href="/blog/kace/k1000-report-pc-with-smartcard-reader/"> <div class="rel"> <img src="/static/assets/img/blog/kace/smartcard/kace.jpg" alt="Find and report all managed Windows PCs in K1000 Inventory with a smartcard reader installed."> <h5>[K1000 Scripting] Find and report all PCs with a smartcard reader installed</h5> </div> </a> <a href="/blog/linux/idenficare-processi-zombie-linux/"> <div class="rel"> <img src="/static/assets/img/blog/zombiesign.jpg" alt="Vediamo come uccidere, con un semplice script, eventuali processi zombie rimasti attivi sul nostro server Linux"> <h5>Identificare e terminare processi zombie su Linux</h5> </div> </a> </div> <!-- comment --> </div> </div> <br> </div> <!-- </div> --> </div> </div> </div> </div> </div> </div> <div class="row" style="background: #1c1e1e"> <div class="col-lg-8 col-lg-offset-2 text-center m-t-lg m-b-lg"> <p id="jalpc_site_pv" style="color: #FFFFFF"> <strong>&copy; 2019 - 2022 Home</strong><br /> <a href="/about/disclaimer/"> Disclaimer </a> | <a href="/about/privacy/"> Informativa Privacy</a> <a rel="me" style="display:none;" href="https://mastodon.uno/@cristiancastellari">Mastodon - @cristiancastellari@mastodon.uno</a> <a rel="me" style="display:none;" href="https://livellosegreto.it/@cristian">@cristian@livellosegreto.it</a> <a rel="me" style="display:none;" href="https://sociale.network/@cristian"></a> </p> </div> </div> </body> </html>
