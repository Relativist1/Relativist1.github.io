<!DOCTYPE html> <html itemscope itemtype="http://schema.org/Person" lang="it"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1 maximum-scale=1; minimum-scale=1; user-scalable=no;"> <meta name="keywords" content="linux,script,process,kill,zombie,server"> <meta name="baseurl" content=""> <meta name="robots" content="index,follow" /> <meta name="rating" content="general"> <!-- favicon --> <link rel="shortcut icon" href=" /static/assets/img/favicon.jpg "> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Identificare e terminare processi zombie su Linux | Home</title> <meta name="generator" content="Jekyll v4.2.2" /> <meta property="og:title" content="Identificare e terminare processi zombie su Linux" /> <meta name="author" content="Saurabh" /> <meta property="og:locale" content="it_IT" /> <meta name="description" content="Vediamo come uccidere, con un semplice script, eventuali processi zombie rimasti attivi sul nostro server Linux" /> <meta property="og:description" content="Vediamo come uccidere, con un semplice script, eventuali processi zombie rimasti attivi sul nostro server Linux" /> <link rel="canonical" href="https://relativist1.github.io/blog/linux/idenficare-processi-zombie-linux/" /> <meta property="og:url" content="https://relativist1.github.io/blog/linux/idenficare-processi-zombie-linux/" /> <meta property="og:site_name" content="Home" /> <meta property="og:image" content="https://relativist1.github.io/static/assets/img/blog/zombiesign.jpg" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2015-10-25T00:00:00+05:30" /> <meta name="twitter:card" content="summary_large_image" /> <meta property="twitter:image" content="https://relativist1.github.io/static/assets/img/blog/zombiesign.jpg" /> <meta property="twitter:title" content="Identificare e terminare processi zombie su Linux" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Saurabh"},"dateModified":"2015-10-25T00:00:00+05:30","datePublished":"2015-10-25T00:00:00+05:30","description":"Vediamo come uccidere, con un semplice script, eventuali processi zombie rimasti attivi sul nostro server Linux","headline":"Identificare e terminare processi zombie su Linux","image":"https://relativist1.github.io/static/assets/img/blog/zombiesign.jpg","mainEntityOfPage":{"@type":"WebPage","@id":"https://relativist1.github.io/blog/linux/idenficare-processi-zombie-linux/"},"url":"https://relativist1.github.io/blog/linux/idenficare-processi-zombie-linux/"}</script> <!-- End Jekyll SEO tag --> <!-- Blog --> <!-- Main CSS --> <link href="/static/assets/app-20190620.min.css" rel="stylesheet"> <link href="/static/css/custom.css" rel="stylesheet"> <!-- Layout Specific CSS --> <link href="/static/css/blogpadding.css" rel="stylesheet" media="screen"> <link href="/static/css/blogmenu.css" rel="stylesheet" media="screen"> <!-- Post/Page Specific CSS --> <!-- Main Scripts --> <script src="/static/assets/app-20190620.min.js"></script> <script src="/static/assets/blog-20190620.min.js"></script> <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/cookie-bar/cookiebar-latest.min.js?theme=momh&customize=1&always=1&showNoConsent=1&showPolicyLink=1&privacyPage=https%3A%2F%2Fcristiancastellari.it%2Fabout%2Fprivacy%2F"></script> </head> <body id="page-top" class="landing-page"> <div class="search-tool" style="position: fixed; top: 0px ; bottom: 0px; left: 0px; right: 0px; opacity: 0.95; background-color: #111111; z-index: 9999; display: none;"> <input type="text" class="form-control search-content" id="search-content" style="position: fixed; top: 60px" placeholder="Search Blog"> <div style="position: fixed; top: 16px; right: 16px; z-index: 9999;"> <img src="/static/assets/img/search/cb-close.png" id="close-btn"/> </div> </div> <div style="position: fixed; right: 16px; bottom: 20px; z-index: 9999;"> <img src="/static/assets/img/search/cb-search.png" id="search-btn" title="Double click Ctrl"/> </div> <div class="navbar-wrapper"> <nav class="navbar navbar-default navbar-fixed-top" role="navigation"> <div class="container"> <div class="navbar-header page-scroll"> <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a class="navbar-brand" href="/">Home</a> </div> <div id="navbar" class="navbar-collapse collapse"> <ul class="nav navbar-nav navbar-right"> <!-- <li><a class="page-scroll" href="/#"></a></li> --> <li> <a class="page-scroll" href="/blog/">Blog</a></li> <li> <a class="page-scroll" href="/kace/">Kace</a></li> <li> <a class="page-scroll" href="/html/">HTML</a></li> <li> <a class="page-scroll" href="/itil/">ITIL</a></li> <li> <a class="page-scroll" href="/linux/">Linux</a></li> <li> <a class="page-scroll" href="/wordpress/">Wordpress</a></li> <li> <a class="page-scroll" href="/games/">Games</a></li> <li> <a class="page-scroll" href="/tools/">Tools</a></li> <li> <a class="page-scroll" href="/life/">Life</a></li> </ul> </div> </div> </nav> </div> <div id="post"> <div class="wrapper wrapper-content animated fadeInRight article"> <div class="row"> <div class="col-lg-10 col-lg-offset-1"> <div class="ibox"> <div class="ibox-content"> <div class="pull-right"> <a class="btn btn-white btn-xs" href="/linux">Linux</a> </div> <div class="text-center article-title"> <span class="text-muted"><i class="fa fa-clock-o"></i> 25 Oct 2015</span> <h1> Identificare e terminare processi zombie su Linux </h1> <div class="vote-info"> <i class="fa fa-book"></i> <a>774 Parole</a> <i class="fa fa-clock-o"></i> <a>Tempo di lettura: 4 minuti</a> </div> </div> <div class="desc"> <img itemprop="image" class="post-image" src="/static/assets/img/blog/zombiesign.jpg" alt="Identificare e terminare processi zombie su Linux"> <p itemprop="description" class="intro">Nei sistemi operativi Unix e Unix-like, un processo zombie o processo defunto è un processo informatico che, nonostante abbia terminato la propria esecuzione, possiede ancora un PID ed un process control block</p> </div> <article> <p>Recentemente ho avuto necessità di eseguire un pò di tuning su un server Linux, spesso infestato da processi zombie che lo portavano a raggiungere elevatissimi carichi operativi. Dalla descrizione di Wikipedia:</p> <blockquote> <p>Nei sistemi operativi Unix e Unix-like, un processo zombie o processo defunto è un processo informatico che, nonostante abbia terminato la propria esecuzione, possiede ancora un PID ed un process control block, necessario per permettere al proprio processo padre di leggerne il valore di uscita.</p> </blockquote> <p>Girovagando alla ricerca di informazioni utili, mi sono imbattuto in un ottimo script, da copiare sui vostri server, in grado di identificare e killare lo zombie, oltre a lasciarne una traccia un un file di log apposito.</p> <ul id="markdown-toc"> <li><a href="#lo-script-kill-zombie" id="markdown-toc-lo-script-kill-zombie">LO SCRIPT KILL-ZOMBIE</a> <ul> <li><a href="#funzionamento" id="markdown-toc-funzionamento">FUNZIONAMENTO</a></li> <li><a href="#inserimento-nel-crontab" id="markdown-toc-inserimento-nel-crontab">INSERIMENTO NEL CRONTAB</a></li> </ul> </li> </ul> <h2 id="lo-script-kill-zombie">LO SCRIPT KILL-ZOMBIE</h2> <p>Come prima cosa, creeremo (con i permessi di root) un nuovo file kill-zombie</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> /root
vi kill-zombies
</code></pre></div></div> <p>In seguito copiamo il seguente codice ed incolliamolo nel file appena creato</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#! /bin/bash</span>
<span class="c">#</span>
<span class="c"># Zombie processes killing script. Must be run under root.</span>
 
<span class="k">case</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="k">in</span>
<span class="nt">--admin</span><span class="p">)</span>
<span class="nb">stat</span><span class="o">=</span><span class="sb">`</span>ps ax | <span class="nb">awk</span> <span class="s1">'{print $1}'</span> | <span class="nb">grep</span> <span class="nt">-v</span> <span class="s2">"PID"</span> | xargs <span class="nt">-n</span> 1 ps lOp | <span class="nb">grep</span> <span class="nt">-v</span> <span class="s2">"UID"</span> | <span class="nb">awk</span> <span class="s1">'{print"pid: "$3" *** parent_pid: "$4" *** status: "$10" *** process: "$13}'</span> | <span class="nb">grep</span> <span class="s2">": Z"</span><span class="sb">`</span>
 
<span class="k">if</span> <span class="o">((</span><span class="k">${#</span><span class="nv">stat</span><span class="k">}</span> <span class="o">&gt;</span> 0<span class="o">))</span><span class="p">;</span><span class="k">then
</span><span class="nb">echo </span>zombie processes found:
<span class="nb">echo</span> <span class="nb">.</span>
ps ax | <span class="nb">awk</span> <span class="s1">'{print $1}'</span> | <span class="nb">grep</span> <span class="nt">-v</span> <span class="s2">"PID"</span> | xargs <span class="nt">-n</span> 1 ps lOp | <span class="nb">grep</span> <span class="nt">-v</span> <span class="s2">"UID"</span> | <span class="nb">awk</span> <span class="s1">'{print"pid: "$3" *** parent_pid: "$4" *** status: "$10" *** process: "$13}'</span> | <span class="nb">grep</span> <span class="s2">": Z"</span>
<span class="nb">echo</span> <span class="nt">-n</span> <span class="s2">"Kill zombies? [y/n]: "</span>
<span class="nb">read </span>keyb
<span class="k">if</span> <span class="o">[</span> <span class="nv">$keyb</span> <span class="o">==</span> <span class="s1">'y'</span> <span class="o">]</span><span class="p">;</span><span class="k">then
</span><span class="nb">echo </span>killing zombies..
ps ax | <span class="nb">awk</span> <span class="s1">'{print $1}'</span> | <span class="nb">grep</span> <span class="nt">-v</span> <span class="s2">"PID"</span> | xargs <span class="nt">-n</span> 1 ps lOp | <span class="nb">grep</span> <span class="nt">-v</span> <span class="s2">"UID"</span> | <span class="nb">awk</span> <span class="s1">'{print$4" status:"$10}'</span> | <span class="nb">grep</span> <span class="s2">"status:Z"</span> | <span class="nb">awk</span> <span class="s1">'{print $1}'</span> | xargs <span class="nt">-n</span> 1 <span class="nb">kill</span> <span class="nt">-9</span>
<span class="k">fi
else
</span><span class="nb">echo </span>no zombies found!
<span class="k">fi</span>
<span class="p">;;</span>
<span class="nt">--cron</span><span class="p">)</span>
<span class="nb">stat</span><span class="o">=</span><span class="sb">`</span>ps ax | <span class="nb">awk</span> <span class="s1">'{print $1}'</span> | <span class="nb">grep</span> <span class="nt">-v</span> <span class="s2">"PID"</span> | xargs <span class="nt">-n</span> 1 ps lOp | <span class="nb">grep</span> <span class="nt">-v</span> <span class="s2">"UID"</span> | <span class="nb">awk</span> <span class="s1">'{print"pid: "$3" *** parent_pid: "$4" *** status: "$10" *** process: "$13}'</span> | <span class="nb">grep</span> <span class="s2">": Z"</span><span class="sb">`</span>
<span class="k">if</span> <span class="o">((</span><span class="k">${#</span><span class="nv">stat</span><span class="k">}</span> <span class="o">&gt;</span> 0<span class="o">))</span><span class="p">;</span><span class="k">then
</span>ps ax | <span class="nb">awk</span> <span class="s1">'{print $1}'</span> | <span class="nb">grep</span> <span class="nt">-v</span> <span class="s2">"PID"</span> | xargs <span class="nt">-n</span> 1 ps lOp | <span class="nb">grep</span> <span class="nt">-v</span> <span class="s2">"UID"</span> | <span class="nb">awk</span> <span class="s1">'{print$4" status:"$10}'</span> | <span class="nb">grep</span> <span class="s2">"status:Z"</span> | <span class="nb">awk</span> <span class="s1">'{print $1}'</span> | xargs <span class="nt">-n</span> 1 <span class="nb">kill</span> <span class="nt">-9</span>
<span class="nb">echo</span> <span class="sb">`</span><span class="nb">date</span><span class="sb">`</span><span class="s2">": killed some zombie processes!"</span> <span class="o">&gt;&gt;</span> /var/log/zombies.log
<span class="k">fi</span>
<span class="p">;;</span>
<span class="k">*</span><span class="p">)</span> <span class="nb">echo</span> <span class="s1">'usage: kill-zombies {--cron|--admin}'</span>
<span class="p">;;</span>
<span class="k">esac</span>
<span class="nb">exit </span>0
</code></pre></div></div> <p>Ora rendiamolo eseguibile e spostiamolo in /usr/bin</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">chmod</span> +x kill-zombies
<span class="nb">mv </span>kill-zombies /usr/bin
</code></pre></div></div> <h3 id="funzionamento">FUNZIONAMENTO</h3> <p>Lo script viene evocato con un flag, che ne modifica il comportamento:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kill-zombies <span class="nt">--admin</span>
</code></pre></div></div> <p>L’esecuzione avviene manualmente. Se vengono rilevati processi zombie l’utente ne viene informato e deve confermare l’operazione</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kill-zombies <span class="nt">--cron</span>
</code></pre></div></div> <p>Lo script <strong>dovrà essere inserito nel crontab</strong> e richiamato quindi a cadenze regolari dal server. I processi vengono killati in automatico e ne viene lasciata traccia in /var/log/zombies.log</p> <h3 id="inserimento-nel-crontab">INSERIMENTO NEL CRONTAB</h3> <p>Richiamiamo l’editor del crontab con questo comando</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>crontab <span class="nt">-e</span>
</code></pre></div></div> <p>Ed inseriamo questa riga:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>/10 <span class="k">*</span> <span class="k">*</span> <span class="k">*</span> <span class="k">*</span> /usr/bin/kill-zombies <span class="nt">--cron</span>
</code></pre></div></div> <p>In questo modo, lo script verrà eseguito ogni 10 minuti a cadenza regolare. In caso si voglia modificare l’intervallo di tempo, sarà sufficiente cambiare ad esempio */10 in */5 (per 5 minuti)</p> <p><a href="https://www.skyflash.it/download/8205/">Download zombies.sh (1 KB)</a></p> <p>Riferimenti:</p> <ul> <li><a href="https://www.skyflash.it/computer/linux-os/identificare-ed-uccidere-processi-zombie-in-un-server-linux/6076/">Identificare ed uccidere processi zombie in un server Linux</a></li> <li><a href="https://help.ubuntu.com/community/CronHowto">CronHowTo</a></li> </ul> </article> <hr> <div class="row"> <div class="row"> <div class="col-md-6"> <h5 style="display: inline;">Tags:</h5> <button class="btn btn-white btn-xs" type="button">Linux</button> <button class="btn btn-white btn-xs" type="button">Scripting</button> <button class="btn btn-white btn-xs" type="button">Process</button> <button class="btn btn-white btn-xs" type="button">sicurezza</button> <button class="btn btn-white btn-xs" type="button">script</button> </div> <div class="col-md-6"> <div class="small text-right"> <div> </div> </div> </div> </div> <br> <div class="row"> <div class="col-lg-12"> <br> <!-- share --> <div class="share-box"> <h5>Condividi:</h5> <div class="share-buttons"> <a class="f" href="https://www.facebook.com/sharer/sharer.php?u=https://relativist1.github.io/blog/linux/idenficare-processi-zombie-linux/" onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook" > <i class="fa fa-facebook-official share-button"> facebook</i> </a> <a class="t" href="https://twitter.com/intent/tweet?text=Identificare e terminare processi zombie su Linux&url=https://relativist1.github.io/blog/linux/idenficare-processi-zombie-linux/" onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter" > <i class="fa fa-twitter share-button"> twitter</i> </a> <a class="r" href="http://www.reddit.com/submit?url=https://relativist1.github.io/blog/linux/idenficare-processi-zombie-linux/" onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;" title="Share on Reddit" > <i class="fa fa-reddit-alien share-button"> reddit</i> </a> <a class="l" href="https://www.linkedin.com/shareArticle?mini=true&url=https://relativist1.github.io/blog/linux/idenficare-processi-zombie-linux/&title=Identificare e terminare processi zombie su Linux&summary=Vediamo come uccidere, con un semplice script, eventuali processi zombie rimasti attivi sul nostro server Linux&source=Home" onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn" > <i class="fa fa-linkedin share-button"> linkedin</i> </a> <a class="e" href="mailto:?subject=Identificare e terminare processi zombie su Linux&amp;body=Check out this site https://relativist1.github.io/blog/linux/idenficare-processi-zombie-linux/" title="Share via Email" > <i class="fa fa-envelope share-button"> email</i> </a> </div> </div> <br> <div class="related-container"> <h4 class="relh4">Potrebbe Interessarti Anche...</h4> <div class="rect"> <a href="/blog/kace/aggiornare-windows10-k1000/"> <div class="rel"> <img src="/static/assets/img/blog/kace/smartcard/kace.jpg" alt="Usiamo Kace per aggiornare un PC da Windows 7/8/10 all'ultima build di Windows 10"> <h5>Distribuire un aggiornamento di build di Windows 10 via Kace</h5> </div> </a> <a href="/blog/kace/distribuzione-certificati_ca-kace1000/"> <div class="rel"> <img src="/static/assets/img/blog/ssl.png" alt="Vediamo insieme come distribuire certificati Windows usando KACE 1000"> <h5>Come importare un certificato CA su PC Windows con Kace 1000</h5> </div> </a> <a href="/blog/kace/blocco-applicativo-k1000/"> <div class="rel"> <img src="/static/assets/img/blog/kace/smartcard/kace.jpg" alt="Come utilizzare KACE 1000 per il controllo ed il blocco dei software non autorizzati sui PC - Una breve guida."> <h5>Blocco delle applicazioni con K1000</h5> </div> </a> <a href="/blog/kace/k1000-report-pc-with-smartcard-reader/"> <div class="rel"> <img src="/static/assets/img/blog/kace/smartcard/kace.jpg" alt="Find and report all managed Windows PCs in K1000 Inventory with a smartcard reader installed."> <h5>[K1000 Scripting] Find and report all PCs with a smartcard reader installed</h5> </div> </a> </div> <!-- comment --> </div> </div> <br> </div> <!-- </div> --> </div> </div> </div> </div> </div> </div> <div class="row" style="background: #1c1e1e"> <div class="col-lg-8 col-lg-offset-2 text-center m-t-lg m-b-lg"> <p id="jalpc_site_pv" style="color: #FFFFFF"> <strong>&copy; 2019 - 2022 Home</strong><br /> <a href="/about/disclaimer/"> Disclaimer </a> | <a href="/about/privacy/"> Informativa Privacy</a> <a rel="me" style="display:none;" href="https://mastodon.uno/@cristiancastellari">Mastodon - @cristiancastellari@mastodon.uno</a> <a rel="me" style="display:none;" href="https://livellosegreto.it/@cristian">@cristian@livellosegreto.it</a> <a rel="me" style="display:none;" href="https://sociale.network/@cristian"></a> </p> </div> </div> </body> </html>
